<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
  <style>body{font-family:Arial, sans-serif;padding:20px;max-width:1000px;margin:auto}</style>
</head>
<body>
  <h1>Dashboard â€” {{ user.full_name or user.email }}</h1>

  <h2>Spending by Category</h2>
  <div id="cat"></div>

  <h2>Monthly Spending</h2>
  <div id="monthly"></div>

  <script>
    const byCategory = {{ by_category | tojson }};
    const monthly = {{ monthly | tojson }};

    // Category pie
    const catLabels = Object.keys(byCategory);
    const catValues = Object.values(byCategory);
    const catData = [{ labels: catLabels, values: catValues, type: 'pie' }];
    Plotly.newPlot('cat', catData, {height:400});

    // Monthly line
    const months = Object.keys(monthly).sort();
    const totals = months.map(m => monthly[m]);
    const lineData = [{ x: months, y: totals, mode:'lines+markers', type:'scatter' }];
    Plotly.newPlot('monthly', lineData, {height:400});
  </script>

</body>
</html>
